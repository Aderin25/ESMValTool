---
# Environment solvability 13 March 2019

# cdo=1.9.6 and ncl=6.6.2 (latest versions
# for each) are working well;

# installing ncl(>=6.5.0) will
# automatically remove r-base (>=3.4.x) becuse gtk2=2.24.31
# and ncl are in conflict with r-base; compatibility between gtk2
# and r-base is limited to only gtk2=2.24.31=hde048ef_0/h5baeb44_1000
# and r-base=3.5.1=he45234b_1005 but those gtk2 hashes have conflicts
# either ncl=(6.5.0, 6.6.2) versions.
#
# Last working ncl+r-base compatibility: ncl=6.4.0/r-base=3.4.1
# DO NOT use ncl=6.4.0 since the executable needs poppler=0.71.0
# (it fails); the upgrade from poppler=0.67.0 -> 0.71.0 removes ncl
# no questions asked and a further installation of ncl>=6.5.0 will
# remove r-base no questions asked. Absolute FUBAR!
#
# SOLVED BY conda-forge freeze at cf201901 (this is working but for
# how long?); see explanation at https://github.com/NCAR/ncl/issues/87

name: esmvaltool
channels:
  - conda-forge/label/cf201901

dependencies:
  # Python packages that cannot be installed from PyPI:
  - gxx_linux-64  # needed since conda uses internal compiler which is empty by default
  - iris
  - matplotlib<3  # Can be installed from PyPI, but is a dependency of iris and should be pinned.
  - python-stratify
  - esmpy
  - xarray  # Can be installed from PyPI, but here to get a consistent set of depencies with iris.
  # Non-Python dependencies
  - graphviz
  - cdo

  # Multi language support:
  - ncl  # must be >=6.5.0
  - r-base
  - jasper!=1.900.31  # pinned NCL dependency
  - libunwind  # Needed for Python3.7+
  # TODO: add julia
