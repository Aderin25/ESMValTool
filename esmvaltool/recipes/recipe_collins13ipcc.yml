###############################################################################
# recipe_collins13ipcc.yml

---
documentation:
  description: | 
    Reproducing selected figures from IPCC AR5, chap. 12 (Collins et al., 2013)

  authors:
   - lore_ru

  references:
   - collins13ipcc

  projects:
    - crescendo

preprocessors:
  preprocessor_1:
    regrid: false
    mask_landocean: false
    multi_model_statistics: false

  preproc_time:
    regrid: false
    mask_landocean: false
    multi_model_statistics: false

  preproc_IAV:
    regrid:
      target_grid: 1x1
      scheme: linear
    mask_landocean: false
    multi_model_statistics: false

diagnostics:

  ###  Mean variable change in one RCP for individual models ###
  
  tas_change_all_models:
    description: Air temperature change for RCP45 for all models as maps.
    themes:
      - phys
    realms:
      - atmos
    variables:
      tas:
        preprocessor: preprocessor_1
        mip: Amon
        field: T2Ms
    additional_datasets:
      - {dataset: ACCESS1-0,  project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1986, end_year: 2005}
      - {dataset: ACCESS1-3,  project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1986, end_year: 2005}
      - {dataset: GFDL-ESM2G, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1986, end_year: 2005}
      - {dataset: MPI-ESM-LR, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1986, end_year: 2005}

      - {dataset: ACCESS1-0,  project: CMIP5, exp: rcp45, ensemble: r1i1p1, start_year: 2081, end_year: 2100}
      - {dataset: ACCESS1-3,  project: CMIP5, exp: rcp45, ensemble: r1i1p1, start_year: 2081, end_year: 2100}
      - {dataset: GFDL-ESM2G, project: CMIP5, exp: rcp45, ensemble: r1i1p1, start_year: 2081, end_year: 2100}
      - {dataset: MPI-ESM-LR, project: CMIP5, exp: rcp45, ensemble: r1i1p1, start_year: 2081, end_year: 2100}

    scripts:
      ch12_map_diff_each_model_fig12-9: &settings
        script: ipcc_ar5/ch12_map_diff_each_model_fig12-9.ncl
        # Required attributes:
        projection: Robinson             # Map projection, any valid ncl projection
        styleset: CMIP5                  # Plot style
        time_avg: annualclim             # Time average ('opt' argument of time_operations.ncl)
        experiment: rcp45                # IPCC Scenario, used to pair historical and rcp runs from same model
        # Optional attributes:	
        max_vert: 9                      # Maximum number of plots in vertical
        max_hori: 5                      # Maximum number of plots in horizontal
        title: "Annual mean surface air temperature change (RCP4.5: 2081-2100)"
        ncdf: "_tas_each_model_1209.nc"  # Name of netcdf file written
        #colormap:                       # colormap to use if do not want default
        diff_levs: [-2., -1.5, -1., -0.5, 0, 0.5, 1, 1.5, 2, 3, 4, 5, 7, 9, 11] # Contour levels for plots
        span: False # boolean to decide if span whole colormap (default = False)

  ts_line:
    description: Prepare data for timeseries of multiple scenarios incl. spread
    themes:
      - phys
    realms:
      - atmos
    variables:
      tas:
        preprocessor: preproc_time
        mip: Amon
        field: T2Ms
    additional_datasets:
     - {dataset: ACCESS1-0,    project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1850, end_year: 2005}
     - {dataset: ACCESS1-3,    project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1850, end_year: 2005}
     - {dataset: CSIRO-Mk3-6-0,project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1850, end_year: 2005}
     - {dataset: GFDL-ESM2G,   project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1861, end_year: 2005}
     - {dataset: IPSL-CM5A-LR, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1850, end_year: 2005}
     - {dataset: MIROC5,       project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1850, end_year: 2005}
     - {dataset: MPI-ESM-LR,   project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1850, end_year: 2005}

     - {dataset: CSIRO-Mk3-6-0,project: CMIP5, exp: rcp26,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: GFDL-ESM2G,   project: CMIP5, exp: rcp26,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: IPSL-CM5A-LR, project: CMIP5, exp: rcp26,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2300}
     - {dataset: MIROC5,       project: CMIP5, exp: rcp26,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: MPI-ESM-LR,   project: CMIP5, exp: rcp26,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}

     - {dataset: ACCESS1-0,    project: CMIP5, exp: rcp45,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: ACCESS1-3,    project: CMIP5, exp: rcp45,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: GFDL-ESM2G,   project: CMIP5, exp: rcp45,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: IPSL-CM5A-LR, project: CMIP5, exp: rcp45,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2300}
     - {dataset: MIROC5,       project: CMIP5, exp: rcp45,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: MPI-ESM-LR,   project: CMIP5, exp: rcp45,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2300}

     - {dataset: CSIRO-Mk3-6-0,project: CMIP5, exp: rcp60,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: GFDL-ESM2G,   project: CMIP5, exp: rcp60,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: IPSL-CM5A-LR, project: CMIP5, exp: rcp60,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: MIROC5,       project: CMIP5, exp: rcp60,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}

     - {dataset: ACCESS1-0,   project: CMIP5,  exp: rcp85,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: ACCESS1-3,   project: CMIP5,  exp: rcp85,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: GFDL-ESM2G,  project: CMIP5,  exp: rcp85,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: MIROC5,      project: CMIP5,  exp: rcp85,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2100}
     - {dataset: MPI-ESM-LR,  project: CMIP5,  exp: rcp85,  ensemble: r1i1p1,  start_year: 2006,  end_year: 2300}

    scripts:
      ch12_ts_line_mean_spread: &ts_settings
        # Required attributes:
        script: ipcc_ar5/ch12_ts_line_mean_spread.ncl
        styleset: CMIP5
        scenarios: [rcp26, rcp45, rcp60, rcp85] # which scenarios included in figure
        syears: [1850, 2006, 2101]      # start years in time periods (e.g. start of historical period and rcps)
        eyears: [2005, 2100, 2300]      # end years in time periods (end year of historical runs and rcps)
        begin_ref_year: 1986            # start year of reference period (e.g. 1986)
        end_ref_year: 2005              # end year of reference period (e.g 2005)
        label: [Historical, RCP2.6, RCP4.5, RCP6.0, RCP8.5] # labels to use in legend depending on scenarios
        # Optional attributes:
        title: "Global surface temperature change (~S~o~N~ C)" # title in plot
        yaxis: "(~S~o~N~ C)"            # y-axis title 
        ymin: -2                        # minimim value on y-axis
        ymax: 12                        # maximum value on y-axis
        model_nr: False                 # boolean, save number of model runs per period and scenario in netcdf to print in plot?
        colormap: ipcc_color_tseries.rgb  # choose file to create colormap from
        #ts_minlat: # minimum latitude if not global e.g(/0/)
        #ts_maxlat: # maximum latitude if not global e.g.(/90/)
        #ts_minlon: # minimum longitude if not global e.g.(/0/)
        #ts_maxlon: # maximum longitude if not global e.g.(/360/)

  IAV_calc_tas:
    description: Calculate temperature IAV for stippling significance
    themes:
      - varmodes
    realms:
      - atmos
    variables:
      tas:
        preprocessor: preproc_IAV
        mip: Amon
        field: T2Ms
    additional_datasets:
      #- {dataset: ACCESS1-0,        project: CMIP5, exp: piControl, ensemble: r1i1p1, start_year: 300,  end_year: 799}
      #- {dataset: ACCESS1-3,        project: CMIP5, exp: piControl, ensemble: r1i1p1, start_year: 250,  end_year: 749}
      - {dataset: bcc-csm1-1,       project: CMIP5, exp: piControl, ensemble: r1i1p1, start_year: 1,    end_year: 500}
      - {dataset: bcc-csm1-1-m,     project: CMIP5, exp: piControl, ensemble: r1i1p1, start_year: 1,    end_year: 400}
      - {dataset: BNU-ESM,          project: CMIP5, exp: piControl, ensemble: r1i1p1, start_year: 1450, end_year: 2008}
      - {dataset: CanESM2,          project: CMIP5, exp: piControl, ensemble: r1i1p1, start_year: 2015, end_year: 3010}

    scripts:
      IAV_calc: &IAV_settings
        script: ipcc_ar5/ch12_calc_IAV_for_stipp_and_hatch.ncl
        # Required attributes:
        styleset: CMIP5
        time_avg: annualclim    # Time average ('opt' argument of time_operations.ncl), if seasonalclim seasons needed
        #seasons: [0, 1, 2, 3]
        # Optional attributes:
        periodlength: 20.

  ###  Mean variable change in one RCP for multi model mean ###
  tas_change_mmm:
    description: Air temperature change for RCPs, periods, significance as maps.
    themes:
      - phys
    realms:
      - atmos
    variables:
      tas:
        preprocessor: preprocessor_1
        mip: Amon
        field: T2Ms
    additional_datasets:
      - {dataset: ACCESS1-0,  project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1986, end_year: 2005}
      - {dataset: ACCESS1-3,  project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1986, end_year: 2005}
      - {dataset: GFDL-ESM2G, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1986, end_year: 2005}
      - {dataset: MPI-ESM-LR, project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1986, end_year: 2005}

      - {dataset: ACCESS1-0,  project: CMIP5, exp: rcp45, ensemble: r1i1p1, start_year: 2081, end_year: 2100}
      - {dataset: ACCESS1-3,  project: CMIP5, exp: rcp45, ensemble: r1i1p1, start_year: 2081, end_year: 2100}
      - {dataset: GFDL-ESM2G, project: CMIP5, exp: rcp45, ensemble: r1i1p1, start_year: 2081, end_year: 2100}
      - {dataset: MPI-ESM-LR, project: CMIP5, exp: rcp45, ensemble: r1i1p1, start_year: 2081, end_year: 2100}

    scripts:
      ch12_calc_map_diff_mmm_tas: &tas_map_settings
        script: ipcc_ar5/ch12_calc_map_diff_mmm_stippandhatch.ncl
        # Required attributes:
        ancestors: ['IAV_calc_tas/IAV_calc']
        scenarios: [rcp45]      #list with scenarios to be included
        periods: [2081]         #list with start years of periods to be included
        time_avg: annualclim  #seasonal or annual means
        projection: Robinson   # map projection, any valid ncl projection  
        label: ["2081-2100"]   # labels on top of each panel, e.g. scenario + rcp, loop to plot is seasons, scenarios, periods, needed to write
        # Optional attributes:
        #seasons:   # list with seasons index to be included if averagetime is "seasonalclim" (required for seasonalclim),  DJF:0, MAM:1, JJA:2, SON:3
        #iavmode:   # use IAV data from multi-model mean calculated by IAV_mmm_for_stippandhatch_ipcc12.ncl or include identical models to the ones plotted calculated for each model on native grid with IAV_for_stippandhatch_ipcc12.ncl default if not given is mmm, otherwise set iavmode = "each"
        #grid:
        #percent: #0 or 1, difference in percent = 1, default = 0

