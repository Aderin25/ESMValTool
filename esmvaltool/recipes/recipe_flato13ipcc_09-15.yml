---
documentation:

  description: |
    Reproducing selected figures from IPCC AR5, chap. 9 (Flato et al., 2013)
    9.2, 9.4, 9.5, 9.8, 9.42a.

  authors:
    - zimm_kl

  maintainer:
    - zimm_kl

  references:
    - flato13ipcc

  projects:
    - crescendo

preprocessors:

  bottom_layer_ts_to_clim_thetao:
    custom_order: True
    extract_month:
      month: 8
    time_average:
    extract_volume:
      z_min: 1000
      z_max: 99999
    extract_bottom_layer:
    regrid: &fig_9_15_regrid
      target_grid: 1x1
      scheme: linear
    convert_units:
      units: degC

  bottom_layer_clim_thetao:
    custom_order: True
    extract_volume:
      z_min: 1000
      z_max: 99999
    extract_bottom_layer:
    regrid:
      <<: *fig_9_15_regrid
    convert_units:
      units: degC

  feb_climatology:
    custom_order: True
    extract_month:
      month: 2
    time_average:
    regrid:
      <<: *fig_9_15_regrid

  aug_climatology:
    custom_order: True
    extract_month:
      month: 8
    time_average:
    regrid:
      <<: *fig_9_15_regrid


FIG_9_15_PARAMS:
  GENERAL: &fig_9_15_params
    start_year: 1986
    end_year: 2005
  CMIP5_MODELS: &fig_9_15_CMIP5_models
    project: CMIP5
    ensemble: r1i1p1
    exp: historical
    additional_datasets:
      - dataset: CanESM2
      - dataset: CNRM-CM5
      - dataset: CSIRO-Mk3-6-0
      - dataset: GFDL-ESM2M
      - dataset: GISS-E2-R
      # - dataset: HadGEM2-ES
      - dataset: IPSL-CM5A-LR
      # - dataset: MPI-ESM-LR
      # - dataset: MRI-CGCM3
      # - dataset: NorESM1-M
      # - dataset: GFDL-ESM2G
      # - dataset: MIROC-ESM-CHEM
  CMIP6_PARAMS: &fig_9_15_CMIP6_params
    project: CMIP6
    activity: CMIP
    grid: gn
    exp: historical
    ensemble: r1i1p1f1
  CMIP6_MODELS_THETAO: &fig_9_15_CMIP6_models_thetao
    additional_datasets:
      # - dataset: BCC-CSM2-MR  # only thetao
      # - dataset: BCC-ESM1  # only thetao
      - dataset: GISS-E2-1-G  # only thetao
      - dataset: IPSL-CM6A-LR
      - dataset: CESM2
  CMIP6_MODELS_SICONC: &fig_9_15_CMIP6_models_siconc
    additional_datasets:
      # - dataset: EC-Earth3-Veg
      - dataset: CESM2
      - dataset: IPSL-CM6A-LR
      # - dataset: MIROC6
      # - dataset: CESM2-WACCM  # broken record


diagnostics:
  ipcc_fig_9_15:
    description: Ocean bottom layer potential temperature (fig 9.15)
    variables:
      thetao_CMIP5_models:
        <<: *fig_9_15_params
        short_name: thetao
        mip: Omon
        field: TO3M
        preprocessor: bottom_layer_ts_to_clim_thetao
        <<: *fig_9_15_CMIP5_models
      thetao_CMIP6_models:
        <<: *fig_9_15_params
        <<: *fig_9_15_CMIP6_params
        short_name: thetao
        mip: Omon
        field: TO3M
        preprocessor: bottom_layer_ts_to_clim_thetao
        <<: *fig_9_15_CMIP6_models_thetao
      thetao_obs:
        <<: *fig_9_15_params
        project: OBS
        short_name: thetao
        mip: Omon
        field: TO3M
        start_year: 1990
        end_year: 1998
        preprocessor: bottom_layer_clim_thetao
        additional_datasets:
          - dataset: WOCE
            tier: 2
            type: clim
            version: 2004
      sic_CMIP5_models_feb: &fig_9_15_sic_CMIP5_models_feb
        <<: *fig_9_15_params
        short_name: sic
        mip: OImon
        field: T2Ms
        preprocessor: feb_climatology
        <<: *fig_9_15_CMIP5_models
      sic_CMIP6_models_feb: &fig_9_15_sic_CMIP6_models_feb
        <<: *fig_9_15_params
        <<: *fig_9_15_CMIP6_params
        short_name: siconc
        mip: SImon
        field: T2Ms
        preprocessor: feb_climatology
        <<: *fig_9_15_CMIP6_models_siconc
      sic_obs_feb: &fig_9_15_sic_obs_feb
        <<: *fig_9_15_params
        short_name: sic
        mip: OImon
        field: T2Ms
        preprocessor: feb_climatology
        additional_datasets:
          - dataset: HadISST
            project: OBS
            tier: 2
            type: reanaly
            version: 1
      sic_CMIP5_models_aug:
        <<: *fig_9_15_sic_CMIP5_models_feb
        preprocessor: aug_climatology
      sic_CMIP6_models_aug:
        <<: *fig_9_15_sic_CMIP6_models_feb
        preprocessor: aug_climatology
      sic_obs_aug:
        <<: *fig_9_15_sic_obs_feb
        preprocessor: aug_climatology
    scripts:
      ipcc_fig_9_15:
        script: ipcc_ar5/ch09_fig09_15.py
        thetao_reference: WOCE
        sic_reference: HadISST
