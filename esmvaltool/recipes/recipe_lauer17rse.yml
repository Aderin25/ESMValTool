# recipe_lauer17rse.yml
---
documentation:
  description: |
    Creates the 20 figures from Lauer et al. (2017) using the ESA CCI
    data sets for sea surface temperature, sea ice, cloud, soil moisture,
    land cover, aerosol, ozone, and greenhouse gases (CO2).

  authors:
    - laue_ax
    - loew_al
    - muel_bn
    - righ_ma
    - senf_da
    - wenz_sa
    - will_ul

  references:
    - lauer17rse

  projects:
    - cmug


preprocessors:
  clim_1x1_05:
    regrid:
      target_grid: 1x1
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.5
    multi_model_statistics:
      span: overlap
      statistics: [mean]
      exclude: [reference_dataset, PATMOS, CLARA-A2, ERA-Interim, MODIS]

  clim_1x1_01:
    regrid:
      target_grid: 1x1
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.1

  clim_5x5:
    regrid:
      target_grid: 5x5
      scheme: linear
    mask_fillvalues:
      threshold_fraction: 0.5


diagnostics:

  # ==========================================================================
  # Lauer et al. (2017) - Figure 7
  # annual mean cloud cover maps + zonal means
  # ==========================================================================

#  fig07_a:
#    description: seasonal mean cloud cover maps
#    variables:
#      clt:
#        mip: Amon
#        field: T2Ms
#        start_year: 1982
#        end_year: 2014
#    additional_datasets:
#      - {dataset: ESACCI-CLOUD, project: OBS, type: sat, version: AVHRR-fv3.0, tier: 2}
#    scripts:
#      clt_clim:
#        script: clouds/clouds.ncl
#        projection: Robinson
#        timemean: seasonalclim
#        panel_labels: false
#
#  fig07_b:
#    description: seasonal mean cloud cover uncertainty maps
#    variables:
#      cltStderr:
#        mip: Amon
#        field: T2Ms
#        start_year: 1982
#        end_year: 2014
#    additional_datasets:
#      - {dataset: ESACCI-CLOUD, project: OBS, type: sat, version: AVHRR-fv3.0, tier: 2}
#    scripts:
#      clterr_clim:
#        script: clouds/clouds.ncl
#        projection: Robinson
#        timemean: seasonalclim
#        panel_labels: false
#        treat_var_as_error: true
#
#  fig07_c:
#    description: zonal means
#    variables:
#      clt:
#        preprocessor: clim_1x1_05
#        mip: Amon
#        field: T2Ms
#        start_year: 1982
#        end_year: 2014
#        exp: [historical, rcp45]
#        reference_dataset: ESACCI-CLOUD
#        additional_datasets:
#          - {dataset: ACCESS1-0, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: ACCESS1-3, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: bcc-csm1-1, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: bcc-csm1-1-m, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: BNU-ESM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CanESM2, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CCSM4, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CESM1-BGC, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CESM1-CAM5, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CESM1-CAM5-1-FV2, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CMCC-CM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CMCC-CMS, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CNRM-CM5, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CSIRO-Mk3-6-0, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: EC-EARTH, project: CMIP5, ensemble: r6i1p1}
##          - {dataset: FGOALS-g2, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: FIO-ESM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-CM3, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-ESM2G, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-ESM2M, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GISS-E2-H, project: CMIP5, ensemble: r1i1p2}
##          - {dataset: GISS-E2-H-CC, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GISS-E2-R, project: CMIP5, ensemble: r1i1p2}
##          - {dataset: GISS-E2-R-CC, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: HadCM3, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: HadGEM2-AO, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: HadGEM2-CC, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: HadGEM2-ES, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: inmcm4, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: IPSL-CM5A-LR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: IPSL-CM5A-MR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: IPSL-CM5B-LR, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: MIROC4h, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: MIROC5, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MIROC-ESM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MIROC-ESM-CHEM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MPI-ESM-LR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MPI-ESM-MR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MRI-CGCM3, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: NorESM1-M, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: NorESM1-ME, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: PATMOS, project: OBS, type: sat, version: 1, tier: 2}
##          - {dataset: CLARA-A2, project: OBS, type: sat, version: dev, tier: 2}
#          - {dataset: ERA-Interim, project: OBS, type: reanaly, version: 1, tier: 3}
#          - {dataset: MODIS, project: OBS, type: sat, version: L3-C6, tier: 2,
#             start_year: 2003, end_year: 2014}
#          - {dataset: ESACCI-CLOUD, project: OBS, type: sat, version: AVHRR-fv3.0, tier: 2}
##      cltStderr:
##        mip: Amon
##        field: T2Ms
##        preprocessor: clim_1x1_05
##        start_year: 1982
##        end_year: 2014
##        additional_datasets:
##          - {dataset: ESACCI-CLOUD, project: OBS, type: sat, version: AVHRR-fv3.0, tier: 2}
#    scripts:
#      clt_zonal:
#        script: clouds/clouds_ipcc.ncl
#        projection: Robinson
#        styleset: CMIP5_ESA
#        timemean: seasonalclim
#        obs_datasets: [ESACCI-CLOUD, PATMOS, CLARA-A2, ERA-Interim, MODIS]

  # ==========================================================================
  # Lauer et al. (2017) - Figure 8
  # maps showing interannual variability of cloud cover
  # ==========================================================================

#  fig08:
#    description: interannual variability
#    variables:
#      clt:
#        preprocessor: clim_1x1_05
#        mip: Amon
#        field: T2Ms
#        start_year: 1982
#        end_year: 2014
#        exp: [historical, rcp45]
#        reference_dataset: ESACCI-CLOUD
#        additional_datasets:
#          - {dataset: ACCESS1-0, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: ACCESS1-3, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: bcc-csm1-1, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: bcc-csm1-1-m, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: BNU-ESM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CanESM2, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CCSM4, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CESM1-BGC, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CESM1-CAM5, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CESM1-CAM5-1-FV2, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CMCC-CM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CMCC-CMS, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CNRM-CM5, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CSIRO-Mk3-6-0, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: EC-EARTH, project: CMIP5, ensemble: r6i1p1}
##          - {dataset: FGOALS-g2, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: FIO-ESM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-CM3, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-ESM2G, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-ESM2M, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GISS-E2-H, project: CMIP5, ensemble: r1i1p2}
##          - {dataset: GISS-E2-H-CC, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GISS-E2-R, project: CMIP5, ensemble: r1i1p2}
##          - {dataset: GISS-E2-R-CC, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: HadCM3, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: HadGEM2-AO, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: HadGEM2-CC, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: HadGEM2-ES, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: inmcm4, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: IPSL-CM5A-LR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: IPSL-CM5A-MR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: IPSL-CM5B-LR, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: MIROC4h, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: MIROC5, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MIROC-ESM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MIROC-ESM-CHEM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MPI-ESM-LR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MPI-ESM-MR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MRI-CGCM3, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: NorESM1-M, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: NorESM1-ME, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: PATMOS, project: OBS, type: sat, version: 1, tier: 2}
##          - {dataset: CLARA-A2, project: OBS, type: sat, version: dev, tier: 2}
#          - {dataset: ERA-Interim, project: OBS, type: reanaly, version: 1, tier: 3}
#          - {dataset: MODIS, project: OBS, type: sat, version: L3-C6, tier: 2,
#             start_year: 2003, end_year: 2014}
#          - {dataset: ESACCI-CLOUD, project: OBS, type: sat, version: AVHRR-fv3.0, tier: 2}
#    scripts:
#      clt_var:
#        script: clouds/clouds_interannual.ncl
#        projection: Robinson
#        colormap: WhiteBlueGreenYellowRed
#        extrafiles: true


  # ==========================================================================
  # Lauer et al. (2017) - Figure 14
  # AOD maps
  # ==========================================================================

#  fig14_a:
#    description: maps of total AOD
#    variables:
#      od550aer:
#        preprocessor: clim_1x1_01
#        mip: aero
#        field: T2Ms
#        start_year: 1997
#        end_year: 2011
#        exp: [historical, rcp45]
#        reference_dataset: ESACCI-AEROSOL
#        additional_datasets:
#          - {dataset: CSIRO-Mk3-6-0, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-CM3, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GISS-E2-H, project: CMIP5, ensemble: r1i1p2}
#          - {dataset: IPSL-CM5B-LR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MIROC-ESM-CHEM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: ESACCI-AEROSOL, project: OBS, type: sat, version: SU-v4.21, tier: 2}
#    scripts:
#      latlon:
#        script: perfmetrics/main.ncl
#        plot_type: latlon
#        projection: Robinson
#        time_avg: annualclim
#        region: Global
#        legend_outside: false
#        plot_diff: true
#        latlon_cmap: WhiteBlueGreenYellowRed
#        t_test: true
#        stippling: false
#        conf_level: 0.95
#        abs_levs: [0, 0.05, 0.1, 0.15, 0.2, 0.25, 0.3,
#                   0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65,
#                   0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1]
#        diff_levs: [-0.5, -0.45, -0.4, -0.35, -0.3, -0.25,
#                    -0.2, -0.15, -0.1, -0.05, 0, 0.05,
#                    0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4,
#                    0.45, 0.5]
#
#  fig14_b:
#    description: maps of fine mode AOD
#    variables:
#      od550lt1aer:
#        preprocessor: clim_1x1_01
#        mip: aero
#        field: T2Ms
#        start_year: 1997
#        end_year: 2011
#        exp: [historical, rcp45]
#        reference_dataset: ESACCI-AEROSOL
#        additional_datasets:
#          - {dataset: CSIRO-Mk3-6-0, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-CM3, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GISS-E2-H, project: CMIP5, ensemble: r1i1p2}
#          - {dataset: IPSL-CM5B-LR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MIROC-ESM-CHEM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: ESACCI-AEROSOL, project: OBS, type: sat, version: SU-v4.21, tier: 2}
#    scripts:
#      latlon:
#        script: perfmetrics/main.ncl
#        plot_type: latlon
#        projection: Robinson
#        time_avg: annualclim
#        region: Global
#        legend_outside: false
#        plot_diff: true
#        latlon_cmap: WhiteBlueGreenYellowRed
#        t_test: true
#        stippling: false
#        conf_level: 0.95
#        abs_levs: [0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15,
#                   0.175, 0.2, 0.225, 0.25, 0.275, 0.3, 0.325,
#                   0.35, 0.375, 0.4, 0.425, 0.45, 0.475, 0.5]
#        diff_levs: [-0.25, -0.225, -0.2, -0.175, -0.15, -0.125,
#                    -0.1, -0.075, -0.05, -0.025, 0, 0.025,
#                    0.05, 0.075, 0.1, 0.125, 0.15, 0.175, 0.2,
#                    0.225, 0.25]
#
#  fig14_c:
#    description: maps of absorption AOD
#    variables:
#      abs550aer:
#        preprocessor: clim_1x1_01
#        mip: aero
#        field: T2Ms
#        start_year: 1997
#        end_year: 2011
#        exp: [historical, rcp45]
#        reference_dataset: ESACCI-AEROSOL
#        additional_datasets:
#          - {dataset: CSIRO-Mk3-6-0, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-CM3, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GISS-E2-H, project: CMIP5, ensemble: r1i1p2}
#          - {dataset: IPSL-CM5B-LR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MIROC-ESM-CHEM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: ESACCI-AEROSOL, project: OBS, type: sat, version: SU-v4.21, tier: 2}
#    scripts:
#      latlon:
#        script: perfmetrics/main.ncl
#        plot_type: latlon
#        projection: Robinson
#        time_avg: annualclim
#        region: Global
#        legend_outside: false
#        plot_diff: true
#        latlon_cmap: WhiteBlueGreenYellowRed
#        t_test: true
#        stippling: false
#        conf_level: 0.95
#        abs_levs: [0, 0.0025, 0.005, 0.0075, 0.01, 0.0125, 0.015,
#                   0.0175, 0.02, 0.0225, 0.025, 0.0275, 0.03, 0.0325,
#                   0.035, 0.0375, 0.04, 0.0425, 0.045, 0.0475, 0.05]
#        diff_levs: [-0.025, -0.0225, -0.02, -0.0175, -0.015, -0.0125,
#                    -0.01, -0.0075, -0.005, -0.0025, 0, 0.0025,
#                    0.005, 0.0075, 0.01, 0.0125, 0.015, 0.0175, 0.02,
#                    0.0225, 0.025]

  # ==========================================================================
  # Lauer et al. (2017) - Figure 19
  # XCO2 time series
  # ==========================================================================

  fig19_a:
    description: time series of XCO2 (global)
    variables:
      xco2:
#        preprocessor: clim_5x5
#        derive: true
        mip: Amon
        field: T2Ms
        start_year: 2003
#        end_year: 2003
        end_year: 2014
#        exp: [esmHistorical, esmrcp85]
        frequency: mon
        reference_dataset: ESACCI-GHG
        additional_datasets:
#          - {dataset: BNU-ESM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: CanESM2, project: CMIP5, ensemble: r1i1p1}
##          - {dataset: CESM1-BGC, project: CMIP5, ensemble: r1i1p2}
##          - {dataset: FIO-ESM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-ESM2G, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: GFDL-ESM2M, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MIROC-ESM, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MPI-ESM-LR, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: MRI-ESM1, project: CMIP5, ensemble: r1i1p1}
#          - {dataset: NorESM1-ME, project: CMIP5, ensemble: r1i1p1}
          - {dataset: ESACCI-GHG, project: obs4mips, level: l3, version: v100, tier: 1}
    scripts:
      tsline:
        script: ipcc_ar5/tsline.ncl
        styleset: CMIP5
        ts_minlat: -90
        ts_maxlat: 90    
        ts_minlon: 0
        ts_maxlon: 360
        multi_model_mean: true
        dont_add_per_year: true
        ts_diff_ref: ESACCI-GHG
        ts_lsmask: refmodel



  # ==========================================================================
  # ==========================================================================
  # ==========================================================================
  # ==========================================================================



  # ==========================================================================
  # Lauer and Hamilton (2013) - Figure 3
  # Taylor plots of multi-year mean quantities
  # ==========================================================================

#  clouds_fig3_clt:
#    description: climatological annual means
#    variables:
#      clt:
#        preprocessor: clim
#        reference_dataset: MODIS
#        mip: Amon
#        field: T2Ms
#    additional_datasets:
#      - {dataset: MODIS, project: obs4mips, level: L3, version: C5,
#         start_year: 2001, end_year: 2010, tier: 1}
#    scripts:
#      clim: &taylor_settings
#        script: clouds/clouds_taylor.ncl
#        # emrabcelegend
#        # -------------
#        # - true:  1) save legend to separate file
#        #          2) plot alternative reference data set (if available) as a
#        #             black or red star and use "altern. ref. dataset" as label
#        # - false: 1) plot legend into taylor plot (same file)
#        #          2) plot alternative reference data set (if available) using
#        #             model symbols and use name of observations as label
#        embracelegend: false
#        # estimate_obs_uncertainty
#        # ------------------------
#        # - true:  estimate observational uncertainties from mean values
#        #          (assuming fractions of obs. RMSE from documentation of the
#        #          obs data); only available for "CERES-EBAF", "MODIS",
#        #          "MODIS-L3"
#        # - false: do not estimate obs. uncertainties from mean values
#        estimate_obs_uncertainty: false
#        # mask_ts_sea_ice
#        # ---------------
#        # - true:  mask T < 272 K as sea ice (only for variable "ts")
#        # - false: no additional grid cells masked for variable "ts"
#        mask_ts_sea_ice: false
#        # styleset
#        # --------
#        # styleset (line styles + symbols) used for plotting
#        # ("CMIP5", "DEFAULT")
#        styleset: CMIP5_ESA
#        # timemean
#        # --------
#        # - annualclim: 1 plot (annual mean)
#        # - seasonalclim: 4 plots (DJF, MAM, JJA, SON)
#        timemean: annualclim
#        # valid_fraction
#        # --------------
#        # used for creating sea ice mask (mask_ts_sea_ice = true): fraction of
#        # valid time steps required to mask grid cell as valid data
#        valid_fraction: 0.5

  # ==========================================================================
  # Lauer and Hamilton (2013) - Equation 2, part of Figure 8
  # Interannual variability: relative temporal standard deviation calculated
  # from monthly mean anomalies after subtracting the climatological mean
  # seasonal cycle
  # ==========================================================================

#  clouds_fig8_lwp:
#    description: interannual variability
#    variables:
#      lwp:
#        preprocessor: clim
#        reference_dataset: UWisc
#        mip: Amon
#        field: T2Ms
#        derive: true
#    additional_datasets:
#      - {dataset: UWisc, project: OBS, type: sat, version: v2,
#         start_year: 1988, end_year: 2007, tier: 3}
#    scripts:
#      clim: &intera_settings
#        script: clouds/clouds_interannual.ncl
#        # colormap
#        # --------
#        # colors for scale bar (e.g., WhiteBlueGreenYellowRed, rainbow)
#        colormap: WhiteBlueGreenYellowRed
#        # extrafiles
#        # ----------
#        # write plots for individual models to separate files (true, false)
#        extrafiles: false
#        # projection
#        # ----------
#        # map projection, e.g., Mollweide, Mercator, CylindricalEquidistant
#        projection: CylindricalEquidistant
#        # timemean
#        # --------
#        # - annualclim: 1 plot (annual mean)
#        # - seasonalclim: 4 plots (DJF, MAM, JJA, SON)
#        timemean: annualclim
