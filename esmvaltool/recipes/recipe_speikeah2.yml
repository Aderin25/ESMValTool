---
documentation:

  description: |
    Calculate the SPEI of few models
  authors:
    - schl_ma

  references:
    - andrews12grl

  projects:
    - crescendo

preprocessors:
  preprocessor1:
    regrid:
      target_grid: 2.0x2.0
      scheme: linear

  preprocessor2:
    regrid:
      target_grid: reference_dataset
      scheme: linear

diagnostics:
  diagnostic1:
    description: Calculating SPEI index for models 
    variables:
      pr:
        reference_dataset: MIROC-ESM
        preprocessor: preprocessor1
        field: T2Ms
      tas:
        reference_dataset: MIROC-ESM
        preprocessor: preprocessor1
        field: T2Ms

    additional_datasets:
      - {dataset: MIROC-ESM, project: CMIP5, mip: Amon,
         exp: [historical, rcp85], ensemble: r1i1p1,
         start_year: 1950, end_year: 2100}
      - {dataset: GFDL-CM3, project: CMIP5, mip: Amon,
         exp: [historical, rcp85], ensemble: r1i1p1,
         start_year: 1950, end_year: 2100}
      - {dataset: IPSL-CM5A-LR, project: CMIP5, mip: Amon,
         exp: [historical,rcp85], ensemble: r1i1p1, 
         start_year: 1950, end_year: 2100}
      # - {dataset: bcc-csm1-1-m, project: CMIP5, mip: Amon,
      #   exp: [historical, rcp85], ensemble: r1i1p1,
      #  start_year: 1950, end_year: 2100}
    scripts:
      script1:
        script: droughtindex/diag_save_spei.r

  spei_collect1:
    description: Wrapper to collect and plot previously calculated SPI index
    scripts:
      spei_collect1:
        script: droughtindex/collect_spei_model.py
        ancestors: ['diagnostic1/script1']

  diagnostic2:
    description: Calculating SPEI index for models 
    variables:
      pr:
        reference_dataset: CRU
        preprocessor: preprocessor2
        field: T2Ms
      tas:
        reference_dataset: CRU
        preprocessor: preprocessor2
        field: T2Ms
    additional_datasets:
      - {dataset: CRU, mip: Amon, project: OBS, type: reanaly,
         version: TS4.02, start_year: 1905, end_year: 2005, tier: 2}
      # - {dataset: ERA-Interim, mip: Amon, project: OBS, type: reanaly,
      #   version: 1, start_year: 1980, end_year: 2005, tier: 3}
      - {dataset: MIROC-ESM, project: CMIP5, mip: Amon, exp: historical,
         ensemble: r1i1p1, start_year: 1905, end_year: 2005}
      - {dataset: GFDL-CM3, project: CMIP5, mip: Amon, exp: historical,
         ensemble: r1i1p1, start_year: 1905, end_year: 2005}
      - {dataset: IPSL-CM5A-LR, project: CMIP5, mip: Amon, exp: historical,
         ensemble: r1i1p1, start_year: 1905, end_year: 2005}
      # - {dataset: bcc-csm1-1-m, project: CMIP5, mip: Amon, exp: historical,
      #  ensemble: r1i1p1, start_year: 1905, end_year: 2005}
    scripts:
      script2:
        script: droughtindex/diag_save_spei.r

  spei_collect2:
    description: Wrapper to collect and plot previously calculated SPEI index
    scripts:
      spei_collect2:
        script: droughtindex/collect_spei_obs_multi.py
        ancestors: ['diagnostic2/script2']
