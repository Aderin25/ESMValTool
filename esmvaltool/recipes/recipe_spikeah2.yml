---
documentation:

  description: |
    Calculate the SPI of few models

  authors:
    - schl_ma

  references:
    - andrews12grl

  projects:
    - crescendo

# datasets:
   # - {dataset: CRU, mip: Amon, project: OBS, type: reanaly, version: 1, start_year: 1901, end_year: 2001, tier: 3}
   # - {dataset: ACCESS1-0, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1901, end_year: 2100}
   # - {dataset: ACCESS1-3, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: BNU-ESM, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: CNRM-CM5, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: EC-EARTH, project: CMIP5, mip: Amon, exp: historical, ensemble: r12i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: GFDL-CM3, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: GFDL-ESM2G, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: GISS-E2-H, project: CMIP5, mip: Amon, exp: historical, ensemble: r6i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: HadGEM2-CC, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: HadGEM2-ES, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: inmcm4, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: IPSL-CM5A-LR, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: IPSL-CM5A-MR, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: IPSL-CM5B-LR, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: MPI-ESM-MR, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}
   # - {dataset: NorESM1-M, project: CMIP5, mip: Amon, exp: historical, ensemble: r1i1p1, start_year: 1990, end_year: 1999}

preprocessors:
  preprocessor2:
    regrid:
      target_grid: 2.0x2.0
      scheme: linear

diagnostics:
  diagnostic2:
    description: Calculating SPI index for models 
    variables:
      pr:
        reference_dataset: ACCESS1-0
        preprocessor: preprocessor2
        field: T2Ms
    additional_datasets:
       - {dataset: ACCESS1-0, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1950, end_year: 2050}
       - {dataset: ACCESS1-3, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1950, end_year: 2050}
       - {dataset: CNRM-CM5, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1950, end_year: 2050}
       # - {dataset: BNU-ESM, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 2000, end_year: 2050}
       # - {dataset: GFDL-CM3, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1900, end_year: 2100}
       # - {dataset: GFDL-ESM2G, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1900, end_year: 2100}
       # - {dataset: GISS-E2-H, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1900, end_year: 2100}
       # - {dataset: HadGEM2-CC, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1900, end_year: 2100}
       # - {dataset: IPSL-CM5A-LR, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1900, end_year: 2100}
       # - {dataset: IPSL-CM5A-MR, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1900, end_year: 2100}
       # - {dataset: IPSL-CM5B-LR, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1900, end_year: 2100}
       # - {dataset: MPI-ESM-MR, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1900, end_year: 2100}
       # - {dataset: NorESM1-M, project: CMIP5, mip: Amon, exp: [historical, rcp85], ensemble: r1i1p1, start_year: 1900, end_year: 2100}

    scripts:
      script2:
        script: droughtindex/diag_save_spi.r

### COLLECT CORRELATIONS AND PLOT ###########################################
  spi_collect2:
    description: Wrapper to collect and plot previously calculated SPI index
    scripts:
      spi_collect2:
        script: droughtindex/collect_spi_model.py
        ancestors: ['diagnostic2/script2']

